---
title: Dynamics 365 CRM パートナーセンターの共同販売コネクタ
ms.topic: how-to
ms.date: 03/01/2021
ms.service: partner-dashboard
ms.subservice: partnercenter-csp
description: パートナーセンターの紹介を Dynamics 365 CRM の共同販売コネクタと同期します。 販売元は、CRM システム内から Microsoft と共同で販売することができます。
author: sroy
ms.author: sroy
ms.localizationpriority: medium
ms.openlocfilehash: 10062fd20e3553856d8b595efd3224ff456c2c49
ms.sourcegitcommit: bff907bdbddc769716c7418a2b4a94ca37c2d590
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/03/2021
ms.locfileid: "101756796"
---
# <a name="co-sell-connector-for-dynamics-365-crm--overview"></a>Dynamics 365 CRM の共同販売コネクタ–概要

### <a name="appropriate-roles"></a>適切なロール

- 紹介管理者
- CRM のシステム管理者またはシステムカスタマイザー

パートナーセンターの共同販売コネクタを使用すると、販売元は CRM システム内から Microsoft と共同で販売することができます。 パートナーセンターを使用して共同販売取引を管理するためのトレーニングを行う必要はありません。 共同販売コネクタを使用して、Microsoft 販売者に連絡するための新しい共同販売参照を作成したり、Microsoft 販売者からの推薦を受け取ったり、紹介を受け入れたり拒否したり、商談の価値や終了日などの取引データを変更したりします。 また、これらの共同販売取引に関するマイクロソフト販売者からの更新を受け取ることもできます。 パートナーセンターではなく、選択した CRM ですべての紹介作業を管理できます。 

このソリューションは、Microsoft のパワー自動化ソリューションに基づいており、パートナーセンター Api を使用しています。

## <a name="before-you-install---pre-requisites"></a>をインストールする前に-前提条件

|**トピック**   |**詳細**   |**リンク**   |
|--------------|--------------------|------|
|Microsoft Partner Network ID |有効な MPN ID が必要です|[MPN](https://partner.microsoft.com/)に参加するには|
|共同販売の準備完了|お客様の IP/サービスソリューションは、共同販売の準備ができている必要があります。|[Microsoft との販売](https://partner.microsoft.com/membership/sell-with-microsoft)| 
|パートナー センター アカウント|パートナーセンターのテナントに関連付けられている MPN ID は、共同販売ソリューションに関連付けられている MPN ID と同じである必要があります。 コネクタをデプロイする前に、パートナーセンターポータルで共同販売の紹介を確認できることを確認します。|[アカウントの管理](create-user-accounts-and-set-permissions.md)|
|パートナー センターのユーザー ロール|コネクタをインストールして使用する従業員は、参照管理者である必要があります|[ユーザー ロールとアクセス許可の割り当て](create-user-accounts-and-set-permissions.md)| 
|Dynamics 365 CRM|CRM ユーザーロールは、システム管理者またはシステムカスタマイザーです。|[Dynamics 365 でロールを割り当てる](/dynamics365/customerengagement/on-premises/customize/privileges-required-customization)|
|パワー自動化フローアカウント|テスト/ステージングおよび運用のためにデータベースを使用して、新しい運用環境を作成します。 データベースが存在する既存の運用環境がある場合は、再利用できます。 コネクタソリューションをインストールするユーザーは、電源を自動で使用し、この環境にアクセスする必要があります。進行状況を監視し、[ソリューション] の [履歴の表示] をクリックすると、インストールが [Power の自動化](https://flow.microsoft.com/) に失敗することを確認できます。|[環境の作成または管理](/power-platform/admin/create-environment#create-an-environment-with-a-database)|

## <a name="install-partner-center-referrals-synchronization-for-dynamics-365-power-automate-solution"></a>Dynamics 365 のパートナーセンターの紹介同期をインストールする (電源自動化ソリューション)

1. [ [パワー自動化](https://flow.microsoft.com) ] にアクセスし、右上隅にある [ **環境** ] を選択します。 この手順では、使用可能な CRM インスタンスを表示します。

2. 右上隅にあるドロップダウンから適切な CRM インスタンスを選択します。

3. 左側のナビゲーションバーで [ **ソリューション** ] を選択します。

4. 上部のメニューの [ **AppSource を開く** ] リンクをクリックします。

   :::image type="content" source="images/cosellconnectors/openappsource.png" alt-text="AppSource を開く":::

5. ポップアップ画面で、 **Dynamics365 のパートナーセンターの紹介コネクタ** を検索します。  

6. [ **今すぐ入手** する] ボタンをクリックし、[ **続行**] をクリックします。

7. これにより、CRM (Dynamics 365) 環境を選択してアプリケーションをインストールできるページが開きます。  使用条件に同意します。

8. 進行状況を監視し、[**ソリューション**] の [**履歴の表示**] をクリックすると、インストールが Power の自動化に失敗することを確認できます。
 

9. インストールが完了したら、[Power の [自動化](https://flow.microsoft.com) ] に戻り、左側のナビゲーション領域から [ **ソリューション** ] を選択します。 **Dynamics 365 のパートナーセンターの紹介同期** は、[ソリューション] の一覧で確認できます。

10. **Dynamics 365 のパートナーセンターの紹介同期** を選択します。 次の電源の自動化フローとエンティティを利用できます。

    :::image type="content" source="images/cosellconnectors/dynamics-available-crms.png" alt-text="使用可能な CRMS":::

## <a name="best-practice-test-before-you-go-live"></a>ベストプラクティス: 運用前にテストする

運用環境でパワー自動化ソリューションをインストール、構成、およびカスタマイズする前に、必ずステージング CRM インスタンスでソリューションをテストしてください。

- ステージング環境/CRM インスタンスに Microsoft Power 自動ソリューションをインストールします。
- ステージング環境で Microsoft パワー自動化ソリューションを構成し、カスタマイズします。
- ステージング/CRM インスタンスでソリューションをテストします。 
- 成功した場合は、運用インスタンスにマネージドソリューションとしてインポートします。 

## <a name="configure-the-solution"></a>ソリューションの構成

1. CRM インスタンスにソリューションをインストールしたら、[ [Power の自動化](https://flow.microsoft.com/)] に戻ります。


2. 右上隅にある [ **環境** ] ドロップダウンで、パワー自動化ソリューションをインストールした CRM インスタンスを選択します。

3. 次の3つのユーザーアカウントを関連付ける接続を作成する必要があります。

   - 参照管理者の資格情報を持つパートナーセンターのユーザー

   - パートナー センターのイベント

   - Power を使用した CRM 管理ソリューションのフローが自動化されます。

      1. 左側のナビゲーションバーから [ **接続** ] を選択し、一覧から "パートナーセンターの紹介" ソリューションを選択します。

      2. [ **接続の作成**] をクリックして接続を作成します。

         :::image type="content" source="images/cosellconnectors/dynamics-1.png" alt-text="接続を作成する":::

      3. 右上隅の検索バーで、 **パートナーセンターの参照 (プレビュー)** を検索します。

      4. 参照管理者の資格情報ロールを使用して、パートナーセンターユーザーの接続を作成します。

      5. 次に、パートナーセンターのユーザーに、参照管理者の資格情報を使用してパートナーセンターのイベント接続を作成します。

      6. CRM 管理者ユーザーの Common Data Service (現在の環境) の接続を作成します。
     
      7. すべての接続を追加すると、環境内に次の接続が表示されます。

:::image type="content" source="images/cosellconnectors/dynamics-2.png" alt-text="接続":::
   
## <a name="edit-the-connections"></a>接続を編集する

1. [ **ソリューション** ] ページに戻り、[ **既定のソリューション**] を選択します。 [**すべて**] をクリックして、[**接続の参照 (プレビュー)** ] を選択します。

:::image type="content" source="images/connection-reference-video.gif" alt-text="接続の編集":::

2. 3つのドットアイコンを選択して、各接続を1つずつ編集します。 関連する接続を追加します。

:::image type="content" source="images/cosellconnectors/dynamics-4.png" alt-text="一覧表示された接続"::: 

3.  [ソリューション] ページに戻り、Dynamics 365 のパートナーセンター紹介同期を選択し、次のシーケンスの各フローの横にある3つのドットアイコンをクリックしてフローをオンにします。 フローをオンにしている間に問題が発生した場合は、 [カスタマイズの手順](connector-dynamics.md#customize-synchronization-steps) と [トラブルシューティングの手順](connectors-troubleshoot.md)を参照してください。 

次の順序でフローを有効にします。

- パートナーセンターの Webhook の登録 (Insider Preview)
- パートナーセンターへの共同販売紹介– Dynamics 365 の作成 (Insider Preview)
- カスタマイズDynamics 365 フローから詳細を作成または取得します。 
- パートナーセンターから Dynamics 365-ヘルパー (Insider Preview)
- パートナーセンターの Microsoft 共同販売参照の更新 Dynamics 365 (Insider Preview)
- パートナーセンターから Dynamics 365 へ (Insider Preview)
- Dynamics 365 からパートナーセンターへ (Insider Preview)
- Dynamics 365 営業案件パートナーセンター (Insider Preview)
- Dynamics 365 Microsoft ソリューション (パートナーセンター) (Insider Preview)
 

## <a name="use-webhook-apis-to-register-for-resource-change-events"></a>Webhook Api を使用してリソース変更イベントに登録する

パートナーセンターの Webhook Api を使用すると、リソース変更イベントに登録できます。 これらの変更イベントは、HTTP 投稿として url に送信されます。

1. [ **パートナーセンター] を Dynamics 365 (Insider Preview) に** 選択します。

2. [ **編集** ] アイコンを選択し、[ **HTTP 要求の受信時**] を選択します。

3. **コピー** アイコンを選択して、指定された HTTP POST URL をコピーします。

 :::image type="content" source="images/webhook-video.gif" alt-text="Webhook を使用してリソースの変更を登録する":::

4. "パートナーセンターの Webhook 登録 (Insider Preview)" パワー自動化フローを選択し、[ **実行**] を選択します。

5. 右側のウィンドウで [実行フロー] ウィンドウが開いていることを確認し、[ **続行**] をクリックします。

6. 次の詳細を入力します。

   - **Http トリガーエンドポイント**: 前の手順からコピーされた URL

   - **登録するイベント**: 使用可能なすべてのイベントを選択します ("紹介-作成済み"、"紹介-更新済み"、"関連付けられている紹介-作成"、"関連付けられた参照-更新")。

   -**既存のトリガーエンドポイントが存在する場合は上書き** する: はい、特定の webhook イベントに登録できるのは1つの URL のみであることに注意することが重要です。 特定の webhook イベントに登録できる URL は1つだけであることに注意してください。 

7. [ **実行** ] を選択し、[完了] を選択し **ます。**

Webhook は、イベントの作成と更新をリッスンできるようになりました。

## <a name="customize-synchronization-steps"></a>同期手順のカスタマイズ

CRM システムは高度にカスタマイズされており、CRM のセットアップに基づいて、パワー自動化ソリューションをカスタマイズできます。  パートナーセンターと CRM システムの間で共同販売参照が同期されると、パートナーセンター PC で同期されるフィールドが、 [カスタムフィールドマッピングガイド](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWxL6S)に一覧表示されます。

フィールドマッピングガイドに従って、必要に応じて、Dynamics 365 フローまたは環境変数 **の [カスタマイズ]**  で、適切な変更を行います。 今後のソリューションのアップグレードに影響する可能性があるため、Power オートメーションソリューションの他のフローを更新しないことをお勧めします。 

使用できるカスタマイズは次のとおりです。

- [営業案件名のチェックマーク]: 既定では、パートナーセンターと Dynamics 365 CRM の間の同期が正常に行われていることを示すために、[営業案件名] の横にチェックマークが表示されます。 同様に、同期に失敗した場合は、クロスマークが表示されます。 営業案件名に check マークまたは十字マークが追加されないようにするには、営業案件名環境変数の [表示] チェックマークの現在の値を [いいえ] に設定します。

- 取引値: 既定では、パートナーセンターからの取引値は CRM の **estimatedvalue** との間で同期されます。 CRM で、同期の対象となるフィールドが異なる場合は、次のようにします。

    a.    CRM のフィールド名を使用して、Dynamics 365 環境変数の商談値フィールド名を更新します。 表示名ではなく、フィールドの名前を指定する必要があることに注意してください。

    b.    編集 **[カスタマイズ] Dynamics 365 flow から詳細を作成または取得**  し、crm での営業案件の **作成または更新** に関する情報を参照して、 **新しい営業案件** を作成し、 **既存の営業** 案件のアクションを更新して crm の正しいフィールドに **DealValue** 値を割り当てます。 また、[**推定収益**] フィールドから **DealValue assignment** を削除します。

- 顧客アカウントの国コード: 新しい紹介を作成するときに、2文字の国コード (ISO 3166) を指定することが必須です。 既定では、国コードは CRM のアカウントの address1_country フィールドと同期されます。 国コードの同期元として CRM に別のフィールドがある場合は、次のようにします。

   a.    2文字のコードを含む Account の非ルックアップ国コードフィールドの場合:

   - Dynamics 365 環境変数の顧客アカウントの国コードフィールド名を CRM のフィールド名に更新します。 表示名ではなく、フィールドの名前を指定する必要があることに注意してください。

   - Edit **[カスタマイズ] Dynamics 365 flow から詳細を作成または取得**  し、crm の [顧客アカウントの作成または取得] 操作に移動して、crm の適切なフィールドに Country 値を割り当てます。 また、[住所 1: 国/地域] フィールドから Country 値の割り当てを削除します。

   b.    アカウントの検索ベースの国コードフィールドの場合:

   - Account に新しいカスタムフィールドを追加し、[参照ベースのフィールド] で選択した値に基づいて、2文字の国コード (ISO 3166) を自動入力します。その逆も同様です。

   - 上記の手順に従って、新しいカスタムフィールドを CRM とパートナーセンターの間で同期します。

- 営業案件のフィールド: データを設定する必要がある営業案件の必須フィールドがある場合、 **Dynamics 365 フローから詳細を作成または取得**  し、CRM および update での **営業案件の作成または更新** に移動する **新しい営業案件のアクションを作成** して、ビジネス要件に基づいて必須フィールドに値を割り当てます。

- 潜在顧客のフィールド: リーダーに必須フィールドがあり、それを設定する必要がある場合は、 **Dynamics 365 フローから詳細を作成または取得**  し、CRM で [ **潜在顧客の作成または更新** ] に移動して、[更新] ビジネス要件に基づいて必須フィールドに値を割り当てる **新しい潜在顧客アクションを作成** します。

- 顧客アカウント: 新しい紹介がパートナーセンターから CRM に同期されると、Power solution ソリューションでは、顧客の会社名と郵便番号を使用して CRM の既存のアカウントを検索しようとします。 見つからない場合は、新しい顧客アカウントが CRM で作成されます。 検索条件と新しいアカウント作成の詳細を更新するには、[カスタマイズ] を編集して **Dynamics 365 フローから詳細を作成または取得** し、CRM での **顧客アカウントの作成または取得** 、および **顧客アカウントの作成アクション** に移動します。

## <a name="update-environment-variable"></a>環境変数の更新

環境変数の値を更新するには:

1. [ **ソリューション** ] ページにアクセスし、[ **既定のソリューション**] を選択します。 [すべて] をクリックして **環境変数** を選択します。

2. 更新する必要がある値の環境変数を選択し、3つのドットアイコンを使用して [ **編集** ] をクリックします。

3. **新しい** 値オプションを使用して **現在の値** を更新し (既定値を更新しないでください)、値を指定します。 値は、変数のデータ型と一致する必要があります。たとえば、Yes/No データ型では Yes または No 値が許可されます。

:::image type="content" source="images/environment-variables-video.gif" alt-text="環境変数の更新":::

- エンドツーエンドの双方向の共同販売参照の同期

パワー自動化ソリューションをインストールし、構成し、カスタマイズしたら、Dynamics 365 とパートナーセンター間の共同販売参照の同期をテストできます。

### <a name="pre-requisites"></a>前提条件

パートナーセンターと Dynamics 365 CRM 間で紹介を同期するために、Power 区分ソリューションでは、Microsoft 固有の紹介フィールドが明確に示されます。 この id により、販売者チームは、共同販売のために Microsoft と共有する参照を決定することができます。

カスタムフィールドとオブジェクトのセットが、ソリューションのインストールの一部として追加されます。 CRM 管理者ユーザーは、 **営業案件** のカスタムフィールドを使用して、別の crm セクションを作成する必要があります。

次のカスタムフィールドは、CRM セクションの一部にする必要があります。

- **パートナーセンターとの同期**: 営業案件を Microsoft パートナーセンターと同期するかどうかを指定します。 既定では、このフィールドの値は [いいえ] であり、Microsoft との営業案件を共有するには、販売者によって明示的に [はい] に設定する必要があります。 パートナーセンターから CRM に共有されている新しい紹介では、このフィールドの値が [はい] に設定されます。

- **参照識別子**: Microsoft パートナーセンターの紹介の読み取り専用識別子フィールド

- **紹介リンク**: Microsoft パートナーセンターでの紹介への読み取り専用リンク
- Microsoft の **ヘルプ** を参照してください。 共同販売の紹介を作成するには、Microsoft からの適切なヘルプを選択してください。 顧客の連絡先は、共同販売の紹介を作成する機会に関連付けられている必要があります。 共同販売以外の参照を作成するには、このフィールドの選択を解除します。 [適切なヘルプが必要] オプションを選択すると、非共同販売の推薦を、いつでも共同販売の紹介に変換できます。

- **Microsoft パートナーセンターの参照の可視性**: Microsoft パートナーセンターの紹介の可視性を選択します。 Microsoft の販売元に見えるようにすることで、共同販売以外の参照が共同販売に変換される可能性があります。 Microsoft ヘルプが必要な場合、既定では、Microsoft の販売者に参照が表示されます。 参照可能としてマークすると、このフィールドを元に戻すことはできません。

- **MICROSOFT CRM 識別子**: 共同販売の紹介が microsoft によって作成され、承認されると、このフィールドには MICROSOFT の CRM 識別子が表示されます。

- **製品: 廃止** : このフィールドを使用したり、CRM セクションに追加したりしないでください。旧バージョンとの互換性のためにのみ使用できます。 代わりに Microsoft Partner Center ソリューションを使用してください。

- **監査**: パートナーセンターの紹介と同期するための読み取り専用の監査証跡

- **Microsoft パートナーセンターソリューション**: 共同販売の準備ができたソリューションまたは microsoft ソリューションを営業案件と関連付けるためのカスタムオブジェクトです。 営業案件から1つまたは複数のソリューションを追加または削除できます。 Microsoft と共有する前に、少なくとも1つの共同販売準備完了または Microsoft ソリューションを営業案件に追加することが必須です。 このオブジェクトを営業案件に関連付けるには、CRM で営業案件フォームを更新します。

  営業案件フォームで適切なタブを選択し、次に示すようにサブグリッドを追加します。

  :::image type="content" source="images/cosellconnectors/dynamics-6.png" alt-text="営業案件フォーム":::

  :::image type="content" source="images/cosellconnectors/dynamics-7.png" alt-text="{alt-text}":::



- Microsoft ソリューションを追加した後は、販売元が追加する必要がないように、共同販売ソリューションの詳細を事前に設定できます。 新しいソリューションの詳細を追加するには、CRM の [Microsoft ソリューションの詳細] オブジェクトにアクセスし、[ **レコードの追加** ] をクリックして1つのエントリを追加するか、 **Excel upload** を使用して複数のエントリを追加します。

:::image type="content" source="images/dynamic-1a.png" alt-text="ソリューションの詳細":::

### <a name="scenarios"></a>モデル

1. CRM で参照が作成または更新され、パートナーセンターで同期される場合の参照の同期:

   1. CRM の **営業案件** セクションで可視性を持つユーザーを使用して、DYNAMICS 365 CRM 環境にサインインします。

   2. Dynamics 365 環境で "新しい営業案件" を作成するときに、[Microsoft パートナーセンター] セクションが表示されていることを確認します。

   :::image type="content" source="images/dynamic-2a.png" alt-text="新しい営業案件"::: 

   3. この機会をパートナーセンターと同期するには、カードビューで次のフィールドが設定されていることを確認します。

      - **Microsoft のヘルプ** を参照してください。共同販売紹介を作成するには、適切なヘルプオプションを選択してください。

         :::image type="content" source="images/dynamic-3a.png" alt-text="カードビューで適切なフィールドを取得する方法":::

      - **顧客の連絡先**: 共同販売の紹介を作成するには、営業案件に顧客の連絡先を追加します。
      - **パートナーセンターとの同期**: はい

      - Microsoft のソリューション: 参照を Microsoft と共有するには、有効な共同販売準備完了または Microsoft ソリューションを営業案件に追加します。
       
      
      :::image type="content" source="images/dynamic-4a.png" alt-text="ソリューション ID":::

   4. 営業案件が Dynamics 365 で作成され、[パートナーセンターとの同期] オプションが [はい] に設定されたら、10分待ってから、パートナーセンターアカウントにサインインします。 参照は Dynamics 365 と参照識別子に同期されます。 参照リンクが設定されます。 エラーが発生した場合は、[監査] フィールドにエラー情報が表示されます。
     
    5. 同様に、[パートナーセンターとの同期] オプションを [はい] に設定した場合は、Dynamics 365 CRM の営業案件を更新すると、パートナーセンターアカウントで変更が同期されます。

    6. パートナーセンターで正常に同期された営業案件は、Dynamics 365 の✔アイコンで識別されます。

2. Microsoft パートナーセンターで参照が作成または更新され、Dynamics 365 環境で同期される場合の参照同期:

   1. パートナーセンターの [ダッシュボード](https://partner.microsoft.com/dashboard/home)にサインインします。

   2. 左側のメニューから [ **紹介** ] を選択します。

   3. **新しい商談** オプションを選択して、パートナーセンターから新しい共同販売紹介を作成します。

   4. Dynamics 365 CRM 環境にサインインします。

   5. **[Open opportunity**] に移動します。 Microsoft パートナーセンターで作成された紹介が Dynamics 365 CRM で同期されるようになりました。

   6. 同期された参照を選択すると、カードビューの詳細が設定されます。

## <a name="next-steps"></a>次のステップ

- [見込み客を管理する](manage-leads.md)

- [共同販売の機会を管理する](manage-co-sell-opportunities.md)

- [Microsoft Power の自動化プラットフォームの詳細](/power-automate/)

- [パートナー センター Webhook](/partner-center/develop/partner-center-webhooks)
