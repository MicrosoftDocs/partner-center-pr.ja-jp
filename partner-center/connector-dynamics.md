---
title: Dynamics 365 CRM パートナーセンターの共同販売コネクタ
description: パートナーセンターの紹介を Dynamics 365 CRM の共同販売コネクタと同期します。 その後、CRM システム内から Microsoft との共同販売を行うことができます。
ms.topic: how-to
ms.service: partner-dashboard
ms.subservice: partnercenter-csp
author: sroy
ms.author: sroy
ms.localizationpriority: medium
ms.date: 03/01/2021
ms.openlocfilehash: c399e00394208ec29dd59a41afe7cce1b1d07253
ms.sourcegitcommit: 1899307642f057070b1bdd647594fc46ba61fb08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/30/2021
ms.locfileid: "108284334"
---
# <a name="co-sell-connector-for-dynamics-365-crm-overview"></a>Dynamics 365 CRM の共同販売コネクタの概要

**適切なロール**

- 紹介管理者
- CRM のシステム管理者またはシステムカスタマイザー

パートナーセンターの共同販売コネクタを使用すると、販売元は CRM システム内から Microsoft と共同で販売することができます。 パートナーセンターを使用して共同販売取引を管理するためのトレーニングを行う必要はありません。 共同販売コネクタを使用して、Microsoft 販売者に連絡したり、Microsoft 販売者からの推薦を受け取ったり、推薦を受け入れたり拒否したり、商談の価値や終了日などの取引データを変更したりするための新しい共同販売の紹介を作成します。 また、これらの共同販売取引に関するマイクロソフト販売者からの更新を受け取ることもできます。 パートナーセンターではなく、選択した CRM ですべての紹介作業を管理できます。

このソリューションはパワー自動化に基づいており、パートナーセンター Api を使用します。

## <a name="prerequisites"></a>前提条件

ソリューションをインストールする前に、次の前提条件を満たしていることを確認してください。

|**トピック**   |**詳細**   |**リンク**   |
|--------------|--------------------|------|
|Microsoft Partner Network (MPN) ID |有効な MPN ID が必要です。|[パートナーネットワークに参加する](https://partner.microsoft.com/)|
|共同販売の準備完了|お客様の IP/サービスソリューションは、共同販売の準備ができている必要があります。|[Microsoft との販売](https://partner.microsoft.com/membership/sell-with-microsoft)|
|パートナー センター アカウント|パートナーセンターのテナントに関連付けられている MPN ID は、共同販売ソリューションに関連付けられている MPN ID と同じである必要があります。 コネクタをデプロイする前に、パートナーセンターポータルで共同販売参照を確認できることを確認します。|[アカウントの管理](create-user-accounts-and-set-permissions.md)|
|パートナー センターのユーザー ロール|コネクタをインストールして使用する従業員は、参照管理者である必要があります。|[ユーザー ロールとアクセス許可の割り当て](create-user-accounts-and-set-permissions.md)|
|Dynamics 365 CRM|CRM ユーザーロールは、システム管理者またはシステムカスタマイザーです。|[Dynamics 365 でロールを割り当てる](/dynamics365/customerengagement/on-premises/customize/privileges-required-customization)|
|パワー自動化フローアカウント|テスト、ステージング、および運用のためのデータベースを使用して、新しい運用環境を作成します。 データベースを含む既存の運用環境がある場合は、再利用できます。 コネクタソリューションをインストールするユーザーには、電源自動化ライセンスとこの環境へのアクセスが必要です。 インストールが失敗した場合に、進行状況を監視し、詳細情報を [Power の自動化](https://flow.microsoft.com/) に取り込むことができます。 [**ソリューション**] の [**履歴の表示**] を選択します。|[環境の作成または管理](/power-platform/admin/create-environment#create-an-environment-with-a-database)|

## <a name="install-partner-center-referrals-synchronization-for-dynamics-365-power-automate-solution"></a>Dynamics 365 のパートナーセンターの紹介同期をインストールする (電源自動化ソリューション)

1. [ [パワー自動化](https://flow.microsoft.com)] にアクセスし、右上隅にある [ **環境** ] を選択します。 この手順では、使用可能な CRM インスタンスを表示します。

1. 右上隅にあるドロップダウンリストから適切な CRM インスタンスを選択します。

1. 左側の [ **ソリューション** ] を選択します。

1. 上部のメニューの [ **AppSource を開く** ] リンクを選択します。

   :::image type="content" source="images/cosellconnectors/openappsource.png" alt-text="開いている AppSource を示すスクリーンショット。":::

1. ポップアップ画面で、 **Dynamics 365 のパートナーセンターの紹介コネクタ** を検索します。  

1. [ **今すぐ入手** する] ボタンを選択し、[ **続行**] を選択します。

1. CRM (Dynamics 365) 環境を選択してアプリケーションをインストールできるページが表示されます。 使用条件に同意します。

1. 進行状況を監視することができます。インストールが失敗した場合は、[**ソリューション**] の [**履歴の表示**] を選択して、Power の自動化の詳細を確認できます。

1. インストールが完了したら、[Power の [自動化](https://flow.microsoft.com) ] に戻り、左側の [ **ソリューション** ] を選択します。 **Dynamics 365 のパートナーセンターの推薦同期** が、[ **ソリューション** ] の一覧で使用できるようになりました。

1. **Dynamics 365 のパートナーセンターの紹介同期** を選択します。 次の電源の自動化フローとエンティティを利用できます。

    :::image type="content" source="images/cosellconnectors/dynamics-available-crms.png" alt-text="使用可能な CRMs を示すスクリーンショット。":::

## <a name="test-before-you-go-live"></a>ライブに移行する前にテストする

運用環境でパワー自動化ソリューションをインストール、構成、およびカスタマイズする前に、必ずステージング CRM インスタンスでソリューションをテストしてください。 次のことを行う必要があります。

- 電源自動化ソリューションをステージング環境の CRM インスタンスにインストールします。
- ステージング環境でパワー自動化ソリューションを構成し、カスタマイズします。
- ステージング CRM インスタンスでソリューションをテストします。
- テストが正常に完了したら、管理ソリューションとして実稼働インスタンスにインポートします。

## <a name="configure-the-solution"></a>ソリューションの構成

1. CRM インスタンスにソリューションをインストールした後、[ [Power 自動](https://flow.microsoft.com/)] に戻ります。

1. 右上隅にある [ **環境** ] ドロップダウンリストで、パワー自動化ソリューションをインストールした CRM インスタンスを選択します。

1. 次の3つのユーザーアカウントを関連付ける接続を作成する必要があります。

   - 参照管理者の資格情報を持つパートナーセンターのユーザー
   - パートナー センターのイベント
   - Power を使用した CRM 管理ソリューションのフローの自動化

   1. 左側の [ **接続** ] を選択し、一覧から [ **パートナーセンターの紹介** ] ソリューションを選択します。

   1. 接続を作成するに **は、[接続の作成**] を選択します。

         :::image type="content" source="images/cosellconnectors/dynamics-1.png" alt-text="接続の作成を示すスクリーンショット。":::

   1. 右上隅の検索バーで、 **パートナーセンターの参照 (プレビュー)** を検索します。

   1. 参照管理者の資格情報ロールを使用して、パートナーセンターユーザーの接続を作成します。

   1. 次に、参照管理者の資格情報を使用して、パートナーセンターのユーザーにパートナーセンターのイベント接続を作成します。

   1. CRM 管理者ユーザーの Common Data Service (現在の環境) の接続を作成します。
     
   1. すべての接続を追加すると、環境内に次の接続が表示されます。

      :::image type="content" source="images/cosellconnectors/dynamics-2.png" alt-text="接続を示すスクリーンショット。":::

## <a name="edit-the-connections"></a>接続を編集する

1. [ **ソリューション** ] ページに戻り、[ **既定のソリューション**] を選択します。 [**すべて**] を選択して、[**接続の参照 (プレビュー)** ] を選択します。

   :::image type="content" source="images/connection-reference-video.gif" alt-text="接続の編集を示すスクリーンショット。":::

1. 各接続を個別に編集するには、省略記号アイコンを選択します。 関連する接続を追加します。

   :::image type="content" source="images/cosellconnectors/dynamics-4.png" alt-text="接続の一覧を示すスクリーンショット。":::

1.  [ **ソリューション** ] ページに戻り、 **Dynamics 365 のパートナーセンター紹介同期** を選択し、次の順序で各フローの横にある省略記号アイコンを選択してフローを有効にします。 フローを有効にしている間に問題が発生した場合は、「 [カスタマイズの手順](connector-dynamics.md#customize-synchronization-steps) と [トラブルシューティングの手順](connectors-troubleshoot.md)」を参照してください。

次の順序でフローを有効にします。

- パートナーセンターの Webhook の登録 (Insider Preview)
- パートナーセンターへの共同販売紹介– Dynamics 365 の作成 (Insider Preview)
- カスタマイズDynamics 365 フローから詳細を作成または取得します。
- パートナーセンターから Dynamics 365-ヘルパー (Insider Preview)
- パートナーセンターの Microsoft 共同販売参照の更新 Dynamics 365 (Insider Preview)
- パートナーセンターから Dynamics 365 へ (Insider Preview)
- Dynamics 365 からパートナーセンターへ (Insider Preview)
- Dynamics 365 営業案件パートナーセンター (Insider Preview)
- Dynamics 365 Microsoft ソリューション (パートナーセンター) (Insider Preview)
 
## <a name="use-webhook-apis-to-register-for-resource-change-events"></a>Webhook Api を使用してリソース変更イベントに登録する

パートナーセンターの webhook Api を使用して、リソース変更イベントの登録を行うことができます。 これらの変更イベントは、HTTP 投稿として URL に送信されます。

1. [ **パートナーセンター] を Dynamics 365 (Insider Preview) に** 選択します。

1. [ **編集** ] アイコンを選択し、[ **HTTP 要求の受信時**] を選択します。

1. **コピー** アイコンを選択して、指定された HTTP POST URL をコピーします。

   :::image type="content" source="images/webhook-video.gif" alt-text="Webhook を使用してリソースの変更を登録する方法を示すスクリーンショット。":::

1. **パートナーセンターの Webhook 登録 (Insider Preview)** パワー自動化フローを選択し、[**実行**] を選択します。

1. [フローの **実行** ] ウィンドウが右ペインに表示されていることを確認し、[ **続行**] を選択します。

1. 次の詳細を入力します。

   - **Http トリガーエンドポイント**: この URL は、前の手順からコピーされました。
   - **登録するイベント**: 使用可能なすべてのイベントを選択します (**紹介-作成**、 **参照-更新**、 **関連付けら** れている参照の作成、関連する紹介- **更新**)。
   - **既存のトリガーエンドポイントが存在する場合は上書きしますか?**: はい。 特定の webhook イベントに登録できる URL は1つだけです。

1. [ **実行フロー**] を選択し、[完了] を選択し **ます。**

Webhook は、イベントのリッスン、作成、および更新を行うことができるようになりました。

## <a name="customize-synchronization-steps"></a>同期手順のカスタマイズ

CRM システムは高度にカスタマイズされており、CRM のセットアップに基づいて、パワー自動化ソリューションをカスタマイズできます。 パートナーセンターと CRM システムの間で共同販売参照が同期されると、パートナーセンター PC で同期されるフィールドが、 [カスタムフィールドマッピングガイド](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWxL6S)に一覧表示されます。

フィールドマッピングガイドに従って、必要に応じて、Dynamics 365 フローまたは環境変数 **の [カスタマイズ]** で、適切な変更を行います。 今後のソリューションのアップグレードに影響を与える可能性があるため、パワー自動化ソリューションの他のフローは更新しないでください。

次のカスタマイズを使用できます。

- **営業案件名にチェックマークを表示** する: 既定では、パートナーセンターと DYNAMICS 365 CRM の間の同期が正常に行われていることを示すために、営業案件名の横にチェックマークが表示されます。 同様に、同期に失敗した場合は、クロスマークが表示されます。 営業案件名にチェックマークまたは十字マークが追加されないようにするには、 **営業案件名環境変数の表示チェックマーク** の現在の値を [いいえ] に設定します。
- **取引値**: 既定では、パートナーセンターからの取引値は CRM の **estimatedvalue** との間で同期されます。 取引値の同期元として CRM に別のフィールドがある場合は、次のようにします。

  - Dynamics 365 環境変数の **取引値** フィールド名を CRM のフィールド名で更新します。 表示名ではなく、フィールドの名前を指定していることを確認してください。
  - 編集 **[カスタマイズ] Dynamics 365 フローから詳細を作成または取得** し、crm での **営業案件の作成または更新** に関するページに移動して、 **新しい営業案件を作成** し、 **既存の営業** 案件のアクションを更新して、crm の適切なフィールドに **DealValue** 値を割り当てます。 また、[**推定収益**] フィールドから **DealValue** の割り当てを削除します。

- **顧客アカウントの国コード**: 新しい紹介を作成するときに、2文字の国コード (ISO 3166) を指定する必要があります。 既定では、国コードは CRM のアカウントの **address1_country** フィールドと同期されます。 同期する国コード用の別のフィールドが CRM にある場合は、次のようにします。

   - 2文字のコードが含まれているアカウント内の非ルックアップの国コードフィールドの場合:
     - Dynamics 365 環境変数の **顧客アカウントの国コード** フィールド名を CRM のフィールド名で更新します。 表示名ではなく、フィールドの名前を指定していることを確認してください。
     - **[カスタマイズ] Dynamics 365 フローから詳細を作成または取得** し、crm アクションの [**顧客アカウントの作成または取得**] に移動して、crm の適切なフィールドに **国** の値を割り当てます。 また、[**住所 1: 国/地域**] フィールドから **country** 値の割り当てを削除します。

   - アカウントの検索ベースの国コードフィールドの場合:
     - アカウントに新しいカスタムフィールドを追加し、参照ベースのフィールドで選択した値に基づいて、2文字の国コード (ISO 3166) を自動的に入力します。逆も同様です。
     - この前の手順に従って、新しいカスタムフィールドを CRM とパートナーセンターの間で同期します。

- **営業案件のフィールド**: データを設定する必要がある **営業案件** の必須フィールドがある場合は、[カスタマイズ] を編集して **Dynamics 365 フローの詳細を作成または取得** し、CRM で [ **営業案件の作成または更新** ] を開き、ビジネス要件に基づいて必須フィールドに値を割り当てる **新しい営業案件アクションを作成** します。
- **潜在顧客のフィールド**: **潜在顧客** に入力が必要な必須フィールドがある場合、[カスタマイズ] を編集して **Dynamics 365 フローから詳細を作成または取得** し、CRM で [ **潜在顧客の作成または更新** ] に移動して、ビジネス要件に基づいて必須フィールドに値を割り当てる **新しい潜在顧客アクションを作成** します。
- **顧客アカウント**: 新しい紹介がパートナーセンターから crm に同期されると、Power Solution の自動化ソリューションでは、顧客の会社名と郵便番号を使用して crm 内の既存のアカウントの検索を試みます。 見つからない場合は、新しい顧客アカウントが CRM で作成されます。 検索条件と新しいアカウントの作成の詳細を更新するには、[カスタマイズ] を編集して **Dynamics 365 フローの詳細を作成または取得** し、CRM で **顧客アカウントを作成または取得** する **アクション** を作成します。

## <a name="update-environment-variable"></a>環境変数の更新

環境変数の値を更新するには:

1. [ **ソリューション** ] ページにアクセスし、[ **既定のソリューション**] を選択します。 [**すべて**] を選択して **環境変数** を選択します。

1. 更新する必要がある値の環境変数を選択し、省略記号アイコンを使用して [ **編集** ] を選択します。

1. [**新しい値**] オプションを使用して値を指定することにより、**現在の値** を更新します (**既定値** を更新しません)。 値は、変数のデータ型と一致している必要があります。 たとえば、Yes または No データ型は、Yes または No のいずれかの値を受け取ります。

   :::image type="content" source="images/environment-variables-video.gif" alt-text="環境変数の更新を示すスクリーンショット。":::

## <a name="end-to-end-bidirectional-co-sell-referral-synchronization"></a>エンドツーエンドの双方向の共同販売参照の同期

パワー自動化ソリューションのインストール、構成、およびカスタマイズが完了したら、Dynamics 365 とパートナーセンター間の共同販売参照の同期をテストできます。

### <a name="prerequisites"></a>前提条件

パートナーセンターと Dynamics 365 CRM 間で紹介を同期するために、Power 区分ソリューションでは、Microsoft 固有の紹介フィールドが明確に示されます。 この id により、販売者チームは、共同販売のために Microsoft と共有する参照を決定することができます。

カスタムフィールドとオブジェクトのセットが、ソリューションのインストールの一部として追加されます。 CRM 管理者ユーザーは、 **営業案件** のカスタムフィールドを使用して、別の crm セクションを作成する必要があります。

次のカスタムフィールドは、CRM セクションの一部にする必要があります。

- **パートナーセンターとの同期**: パートナーセンターとの営業案件を同期するかどうかを指定します。 既定では、このフィールドの値は [いいえ] であり、Microsoft との営業案件を共有するには、販売者によって明示的に [はい] に設定する必要があります。 パートナーセンターから CRM に共有されている新しい紹介では、このフィールドの値が [はい] に設定されます。
- **参照識別子**: パートナーセンターの紹介の読み取り専用識別子フィールドです。
- **紹介リンク**: パートナーセンターでの紹介への読み取り専用リンク。
- Microsoft の **ヘルプ** を参照してください。 共同販売の紹介を作成するには、Microsoft からの適切なヘルプを選択します。 顧客の連絡先は、共同販売の紹介を作成する機会に関連付けられている必要があります。 共同販売以外の推薦を作成するには、このフィールドを選択しないでください。 共同販売以外の推薦は、適切なヘルプを必要とするオプションを選択することで、いつでも共同販売の紹介に変換できます。
- **Microsoft パートナーセンターの参照の可視性**: パートナーセンターの紹介の可視性を選択します。 Microsoft の販売元に見えるようにすることで、共同販売以外の参照が共同販売に変換される可能性があります。 Microsoft ヘルプが必要な場合、既定では、Microsoft の販売者に参照が表示されます。 このフィールドを表示済みとしてマークした後は、元に戻すことはできません。
- **MICROSOFT CRM 識別子**: 共同販売の紹介が microsoft によって作成され、承認されると、このフィールドには MICROSOFT の CRM 識別子が表示されます。
- **製品: 廃止**: このフィールドを使用したり、CRM セクションに追加したりしないでください。 旧バージョンとの互換性のためにのみ使用できます。 代わりに、パートナーセンターソリューションを使用してください。
- **Audit**: パートナーセンターの紹介と同期するための読み取り専用の監査証跡。
- **Microsoft パートナーセンターソリューション**: 共同販売の準備ができたソリューションまたは microsoft ソリューションを営業案件と関連付けるためのカスタムオブジェクトです。 営業案件から1つまたは複数のソリューションを追加または削除できます。 Microsoft と共有する前に、少なくとも1つの共同販売準備完了または Microsoft ソリューションを営業案件に追加することが必須です。 このオブジェクトを営業案件に関連付けるには、CRM で **営業案件** フォームを更新します。

  **営業案件** フォームで適切なタブを選択し、次に示すようにサブグリッドを追加します。

  :::image type="content" source="images/cosellconnectors/dynamics-6.png" alt-text="営業案件フォームを示すスクリーンショット。":::

  :::image type="content" source="images/cosellconnectors/dynamics-7.png" alt-text="Microsoft ソリューションを示すスクリーンショット。":::

- Microsoft ソリューションを追加した後は、販売元が追加する必要がないように、共同販売の準備ができたソリューションの詳細を事前に設定できます。 新しいソリューションの詳細を追加するには、CRM の Microsoft Solution Details オブジェクトにアクセスし、[ **レコードの追加** ] を選択して1つのエントリを追加するか、 **Excel upload** を使用して複数のエントリを追加します。

  :::image type="content" source="images/dynamic-1a.png" alt-text="新しい Microsoft ソリューションの詳細を示すスクリーンショット。":::

### <a name="scenarios"></a>シナリオ

1. CRM で参照が作成または更新され、パートナーセンターで同期される場合の参照同期:

   1. CRM の **営業案件** セクションで可視性を持つユーザーを使用して、DYNAMICS 365 CRM 環境にサインインします。

   1. Dynamics 365 環境で新しい営業案件を作成するときに、[ **Microsoft パートナーセンター** ] セクションが表示されていることを確認します。

      :::image type="content" source="images/dynamic-2a.png" alt-text="新しい営業案件を示すスクリーンショット。":::

   1. この機会をパートナーセンターと同期するには、カードビューで次のフィールドが設定されていることを確認します。

      - **Microsoft のヘルプについ** て教えてください。共同販売の紹介を作成するには、適切なヘルプオプションを選択してください。

         :::image type="content" source="images/dynamic-3a.png" alt-text="カードビューで適切なフィールドを取得する方法を示すスクリーンショット。":::

      - **顧客の連絡先**: 共同販売の紹介を作成するには、営業案件に顧客の連絡先を追加します。
      - **パートナーセンターとの同期**: はい。
      - **Microsoft のソリューション**: 参照を microsoft と共有するには、有効な共同販売準備完了または microsoft ソリューションを営業案件に追加します。
      
        :::image type="content" source="images/dynamic-4a.png" alt-text="ソリューション ID を示すスクリーンショット。":::

   1. Dynamics 365 で営業案件を作成し、[ **パートナーセンターとの同期** ] オプションを [はい] に設定した後、10分間待機します。 次に、パートナーセンターアカウントにサインインします。 参照は Dynamics 365 と **参照識別子** に同期されます。 **参照リンク** が設定されます。 エラーが発生した場合は、[ **監査** ] フィールドにエラー情報が表示されます。
     
    1. 同様に、[ **パートナーセンターとの同期** ] オプションを [はい] に設定した場合は、DYNAMICS 365 CRM の営業案件を更新すると、パートナーセンターアカウントで変更が同期されます。

    1. パートナーセンターで正常に同期された営業案件は、Dynamics 365 の✔アイコンで識別されます。

1. 参照がパートナーセンターで作成または更新され、Dynamics 365 環境で同期される場合の参照同期:

   1. パートナーセンターの [ダッシュボード](https://partner.microsoft.com/dashboard/home)にサインインします。

   1. 左側のメニューから [ **紹介** ] を選択します。

   1. **新しい商談** オプションを選択して、パートナーセンターから新しい共同販売紹介を作成します。

   1. Dynamics 365 CRM 環境にサインインします。

   1. **オープンチャンス** にアクセスします。 パートナーセンターで作成された紹介が Dynamics 365 CRM で同期されるようになりました。

   1. 同期された参照を選択すると、カードビューの詳細が設定されます。

## <a name="next-steps"></a>次のステップ

- [見込み客を管理する](manage-leads.md)
- [共同販売の機会を管理する](manage-co-sell-opportunities.md)
- [Microsoft Power の自動化プラットフォームの詳細](/power-automate/)
- [パートナー センター Webhook](/partner-center/develop/partner-center-webhooks)
